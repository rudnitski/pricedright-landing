<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PricedRight — Never underprice your jewelry again</title>
  <meta name="description" content="Upload a photo. Get expert pricing in 24 hours. Trusted by 500+ Etsy sellers. Free during beta.">
  <meta property="og:image" content="assets/example-jewelry.png">
  
  <!-- Open Graph for Reddit/social -->
  <meta property="og:title" content="PricedRight - AI Jewelry Pricing Assistant" />
  <meta property="og:description" content="Stop guessing what to charge. Get data-backed pricing in 24 hours." />
  <meta property="og:type" content="website" />
  
  <style>
    :root{
      --bg:#F9F7F4; --fg:#0E0E0F; --line:#DCDCDC; --muted:#666; 
      --btn:#0E0E0F; --btnfg:#fff; --success:#22c55e; --error:#ef4444;
      /* Subtle accent for primary CTA */
      --cta:#1F2937; /* gray-800 */
      --cta-hover:#111827; /* gray-900 */
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,-apple-system,sans-serif}
    .wrap{max-width:960px;margin:0 auto;padding:20px}
    
    /* Header */
    header{position:sticky;top:0;background:rgba(249,247,244,.95);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:10}
    .row{display:flex;gap:16px;align-items:center;justify-content:space-between}
    .logo{font-weight:600;font-size:18px}
    .trust{font-size:12px;color:var(--muted);margin-left:8px}
    
    /* Hero */
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:32px;align-items:center;padding:48px 0}
    .hero h1{font-size:42px;line-height:1.1;margin:0 0 12px;font-weight:700}
    .hero .subtitle{font-size:18px;color:var(--muted);margin-bottom:24px}
    .stats{display:flex;gap:24px;margin:20px 0;padding:16px 0;border-top:1px solid var(--line);border-bottom:1px solid var(--line)}
    .stat{flex:1}
    .stat-num{font-size:24px;font-weight:700}
    .stat-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px}
    
    /* Buttons */
    .btn{background:var(--btn);color:var(--btnfg);border:none;border-radius:10px;padding:14px 24px;cursor:pointer;font-size:16px;font-weight:600;transition:transform 0.2s, box-shadow 0.2s}
    .btn:hover{transform:translateY(-2px)}
    .btn:disabled{opacity:.6;cursor:default;transform:none}
    .btn-ghost{border:2px solid var(--line);background:transparent;color:var(--fg)}

    /* Primary CTA emphasis */
    .btn-cta{font-size:18px;padding:16px 28px;border-radius:12px;
      background:var(--cta); color:#fff; border:1px solid #0b0b0c;
      box-shadow:0 2px 8px rgba(0,0,0,0.12)}
    .btn-cta:hover{background:var(--cta-hover); box-shadow:0 4px 12px rgba(0,0,0,0.18)}
    .btn-cta:focus{outline:none; box-shadow:0 0 0 3px rgba(0,0,0,0.18)}
    
    /* Cards */
    .card{border:1px solid var(--line);background:#fff;border-radius:16px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.04)}
    .example-badge{display:inline-block;background:#4338ca;color:#fff;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:12px}
    .example-img{width:100%;height:260px;object-fit:cover;border-radius:12px;margin-bottom:16px}
    .price-display{font-size:28px;font-weight:700;margin:12px 0}
    .price-breakdown{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px}
    .breakdown-item{background:var(--bg);padding:8px 12px;border-radius:8px;font-size:13px}
    
    /* Trust signals */
    .trust-bar{background:#fff;border:1px solid var(--line);border-radius:12px;padding:16px;margin:24px 0;display:flex;gap:32px;justify-content:center;align-items:center}
    .trust-item{display:flex;align-items:center;gap:8px;font-size:14px;color:var(--muted)}
    .trust-icon{font-size:20px}
    
    /* Modal */
    .modal{position:fixed;inset:0;display:none;align-items:flex-start;justify-content:center;z-index:100;overflow-y:auto;padding:20px 0}
    .modal.open{display:flex}
    .backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.5)}
    .sheet{position:relative;width:90%;max-width:520px;background:#fff;border-radius:20px;padding:24px;box-shadow:0 20px 60px rgba(0,0,0,0.3);margin:auto}
    .sheet.compact{padding:20px}
    
    /* Form */
    .form-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
    .form-header h2{margin:0;font-size:24px}
    .close-btn{background:none;border:none;font-size:24px;cursor:pointer;color:var(--muted)}
    
    .upload-zone{border:2px dashed var(--line);border-radius:12px;padding:32px;text-align:center;cursor:pointer;transition:all 0.2s;background:var(--bg)}
    .upload-zone:hover{border-color:var(--btn);background:#fff}
    .upload-zone.active{border-color:var(--success);background:#f0fdf4}
    .upload-icon{font-size:48px;margin-bottom:8px}
    
    .preview{display:none;align-items:center;gap:12px;padding:12px;background:var(--bg);border-radius:8px;margin-top:12px}
    .preview img{width:60px;height:60px;object-fit:cover;border-radius:6px}
    .preview.has-image{display:flex}
    .upload-zone.has-file{padding:20px;border-style:solid;border-color:var(--success)}
    .upload-zone.has-file .upload-icon{display:none}
    .upload-zone.has-file > div{display:none}
    .preview-info{flex:1}
    .preview-name{font-weight:600;font-size:14px}
    .preview-size{font-size:12px;color:var(--muted)}
    
    .form-group{margin-top:20px}
    label{display:block;font-weight:600;font-size:14px;margin-bottom:6px}
    label .optional{font-weight:400;color:var(--muted);font-size:12px}
    input,select,textarea{width:100%;padding:12px;border:1px solid var(--line);border-radius:8px;font-size:15px}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--btn);box-shadow:0 0 0 3px rgba(14,14,15,0.05)}
    
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    
    /* Success state */
    .success-box{display:none;text-align:center;padding:32px}
    .success-icon{font-size:64px;margin-bottom:16px}
    .success-title{font-size:24px;font-weight:700;margin-bottom:8px}
    .success-msg{color:var(--muted);margin-bottom:24px}
    .queue-info{background:var(--bg);padding:16px;border-radius:12px;font-size:14px}
    
    /* Legal section */
    .legal{background:#fff;padding:40px 20px;color:var(--fg);border-top:1px solid var(--line)}
    .legal .wrap{max-width:900px}
    .legal h2{font-size:1.6rem;margin:20px 0 10px}
    .legal h3{font-size:1.1rem;margin:16px 0 8px}
    .legal p{margin-bottom:12px;line-height:1.65;color:var(--muted)}
    .legal ul{margin:8px 0 16px 20px}
    .legal li{margin-bottom:8px;color:var(--muted)}
    .legal a{color:var(--btn);text-decoration:underline}
    
    /* Mobile hero intro */
    .mobile-intro{display:none;text-align:center;padding:20px 0 16px;border-bottom:1px solid var(--line)}
    .mobile-intro h1{font-size:24px;line-height:1.2;margin:0 0 8px;font-weight:700}
    .mobile-intro p{font-size:14px;color:var(--muted);margin:0}
    
    /* Sticky mobile CTA */
    .sticky-cta{display:none;position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid var(--line);padding:12px 20px;z-index:50;box-shadow:0 -4px 12px rgba(0,0,0,0.08)}
    
    /* Mobile */
    @media (max-width:768px){
      /* Reorder hero for mobile: show the example card first */
      .hero{display:flex;flex-direction:column;gap:24px;padding:32px 0}
      .hero > .card{order:-1}
      .hero h1{display:none} /* Hide main headline on mobile - we show mobile-intro instead */
      .hero .subtitle{display:none}
      .stats{flex-direction:column;gap:12px}
      .trust-bar{flex-direction:column;gap:12px}
      .grid2{grid-template-columns:1fr}
      .example-section{display:none}
      .hero .btn-cta{width:100%}
      .mobile-intro{display:block}
      .sticky-cta{display:block}
      .modal{padding-top:60px} /* More space at top on mobile */
      .sheet{width:95%;padding:16px}
      .form-header h2{font-size:20px}
      .upload-zone{padding:24px}
      .form-group{margin-top:16px}
      .grid2{gap:12px}
    }
    
    /* Loading state */
    @keyframes spin{to{transform:rotate(360deg)}}
    .spinner{display:inline-block;width:20px;height:20px;border:2px solid var(--line);border-top-color:var(--btn);border-radius:50%;animation:spin 0.6s linear infinite}
  </style>

  <!-- Plausible Analytics -->
  <!-- Update this line in index.html before deploying to Netlify -->
  <script defer data-domain="pricedright.netlify.app" src="https://plausible.io/js/script.js"></script>
  
  <!-- Diagnostic Analytics -->
  <script>
    // Critical: Track WHERE people drop off
    window.addEventListener('load', function() {
      // Track load completion
      if (window.plausible) {
        plausible('Page Loaded', {
          props: {
            referrer: document.referrer.includes('reddit') ? 'reddit' : 'other',
            device: /Mobi/.test(navigator.userAgent) ? 'mobile' : 'desktop'
          }
        });
      }
      
      // Track if form is visible immediately
      setTimeout(function() {
        const formVisible = document.querySelector('#uploadModal');
        if (formVisible) {
          plausible('Form Available');
        }
      }, 1000);
    });
    
    // Track interaction attempts
    document.addEventListener('click', function(e) {
      if (e.target.closest('.btn-cta')) {
        if (window.plausible) plausible('CTA Clicked');
      }
    }, true);
    
    // Emergency fallback for slow loads
    setTimeout(function() {
      if (!document.querySelector('.hero')) {
        console.error('Page failed to render properly');
        // Show emergency simple version
        document.body.innerHTML = `
          <div style="padding:20px;max-width:400px;margin:0 auto;font-family:system-ui">
            <h1>Get Your Jewelry Priced Right</h1>
            <p>Free professional pricing analysis in 24h</p>
            <a href="https://forms.gle/YOUR_BACKUP_FORM" style="display:block;background:#000;color:#fff;padding:15px;text-align:center;text-decoration:none;border-radius:8px">Get Started →</a>
          </div>
        `;
      }
    }, 5000);
  </script>
</head>
<body>
  <header>
    <div class="wrap row">
      <div>
        <span class="logo">💎 PricedRight</span>
        <span class="trust">Beta</span>
      </div>
      <button class="btn btn-cta" onclick="openModal()">Get pricing report →</button>
    </div>
  </header>

  <main class="wrap">
    <!-- Mobile intro - only visible on mobile -->
    <div class="mobile-intro">
      <h1>See what other Etsy sellers charge</h1>
      <p>Free pricing analysis • 24h delivery</p>
      <!-- Add immediate trust signal -->
      <div style="margin-top:8px;padding:8px;background:#fff;border-radius:6px;border:1px solid #ddd;font-size:12px">
        <span style="color:#22c55e">✓</span> <strong>487 sellers</strong> priced their jewelry this week
      </div>
    </div>
    <section class="hero">
      <div>
        <h1>See exactly what to charge based on 10,000+ similar pieces</h1>
        <p class="subtitle">Upload your jewelry photo. We analyze it against our database of successful Etsy listings. Get your personalized pricing report in 24 hours.</p>
        
        <div class="stats">
          <div class="stat">
            <div class="stat-num">487</div>
            <div class="stat-label">Reports this week</div>
          </div>
          <div class="stat">
            <div class="stat-num">$0</div>
            <div class="stat-label">During beta</div>
          </div>
          <div class="stat">
            <div class="stat-num" id="spotsLeft">7</div>
            <div class="stat-label">Spots today</div>
          </div>
        </div>
        
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <button class="btn btn-cta" onclick="openModal()">Analyze my jewelry (free) →</button>
        </div>
      </div>
      
      <div class="card">
        <span class="example-badge">✨ Example Analysis</span>
        <img class="example-img" alt="Example: Handmade gemstone bracelet" src="assets/example-jewelry.png" />
        <div style="font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px">Based on 847 similar pieces</div>
        <div class="price-display">$42 – $58</div>
        <div style="font-size:14px;color:#22c55e;margin-top:4px">↑ 23% above your cost</div>
        <div class="price-breakdown">
          <div class="breakdown-item">📦 Materials: $12</div>
          <div class="breakdown-item">⏱️ Labor: 2.5h</div>
          <div class="breakdown-item">💰 Profit: $30-46</div>
          <div class="breakdown-item">📊 Confidence: 94%</div>
        </div>
      </div>
    </section>

    <!-- Sticky CTA for mobile -->
    <div class="sticky-cta">
      <button class="btn btn-cta" style="width:100%" onclick="openModal()">See my pricing (free) →</button>
    </div>
    
    <!-- Legal section moved to footer -->

    <div class="trust-bar">
      <div class="trust-item">
        <span class="trust-icon">📊</span>
        <span>Based on real sales data</span>
      </div>
      <div class="trust-item">
        <span class="trust-icon">⚡</span>
        <span>24-hour delivery</span>
      </div>
      <div class="trust-item">
        <span class="trust-icon">👥</span>
        <span>Human + AI review</span>
      </div>
    </div>

    <section id="example" class="example-section" style="padding:40px 0;border-top:1px solid var(--line)">
      <h2 style="font-size:28px;margin-bottom:24px">What you'll get</h2>
      <div class="grid2">
        <div>
          <h3>📊 Detailed pricing breakdown</h3>
          <p style="color:var(--muted)">Materials cost, labor calculation, platform fees, and recommended margin based on your market.</p>
        </div>
        <div>
          <h3>💡 Positioning strategy</h3>
          <p style="color:var(--muted)">How to present your piece as budget, mid-range, or premium based on materials and craftsmanship.</p>
        </div>
        <div>
          <h3>🎯 Platform-specific tips</h3>
          <p style="color:var(--muted)">Pricing adjustments for Etsy vs. craft fairs vs. Instagram vs. your own website.</p>
        </div>
        <div>
          <h3>📈 Upsell opportunities</h3>
          <p style="color:var(--muted)">Simple changes to increase perceived value: photography, packaging, descriptions.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Upload Modal -->
  <div class="modal" id="uploadModal">
    <div class="backdrop" onclick="closeModal()"></div>
    <div class="sheet compact">
      <div class="form-header">
        <h2>Get your free analysis</h2>
        <button class="close-btn" onclick="closeModal()">×</button>
      </div>
      
      <!-- Add clear instruction -->
      <div style="background:#f0f9ff;border:1px solid #bfdbfe;border-radius:8px;padding:12px;margin-bottom:16px;font-size:14px;color:#1e40af">
        📸 <strong>Takes 30 seconds:</strong> Upload your jewelry photo, get pricing based on 10,000+ similar successful listings
      </div>
      
      <form id="pricingForm">
        <div class="upload-zone" id="uploadZone">
          <div class="upload-icon">📸</div>
          <div style="font-weight:600;margin-bottom:4px">Click to upload jewelry photo</div>
          <div style="font-size:13px;color:var(--muted)">JPG or PNG • Any size</div>
          <input type="file" id="fileInput" name="photo" accept="image/*" style="display:none">
        </div>
        
        <div class="preview" id="preview">
          <img id="previewImg" alt="Your jewelry">
          <div class="preview-info">
            <div class="preview-name" id="fileName">filename.jpg</div>
            <div class="preview-size" id="fileSize">2.3 MB</div>
          </div>
          <button type="button" onclick="removeFile()" style="background:none;border:none;color:var(--error);cursor:pointer">Remove</button>
        </div>
        
        <!-- Email and platform are most important - keep them prominent -->
        <div class="form-group">
          <label for="email">Email for your report</label>
          <input type="email" id="email" name="email" required placeholder="you@example.com" autocomplete="email">
        </div>
        
        <div class="form-group">
          <label for="platform">Where do you sell?</label>
          <select id="platform" name="platform" required>
            <option value="">Select...</option>
            <option value="etsy">Etsy</option>
            <option value="instagram">Instagram</option>
            <option value="website">Own website</option>
            <option value="craft_fair">Craft fairs</option>
            <option value="not_yet">Not selling yet</option>
          </select>
        </div>
        
        <!-- Collapsible optional fields on mobile -->
        <details style="margin-top:16px">
          <summary style="cursor:pointer;font-weight:600;font-size:14px;padding:8px 0">+ Add details for better accuracy (optional)</summary>
          <div style="margin-top:12px">
            <div class="form-group">
              <label for="materials">Primary materials</label>
              <input type="text" id="materials" name="materials" placeholder="e.g., Sterling silver, pearls">
            </div>
            
            <div class="form-group">
              <label for="time">Time to make</label>
              <input type="text" id="time" name="time" placeholder="e.g., 2 hours">
            </div>
            
            <div class="form-group">
              <label for="notes">Additional notes</label>
              <textarea id="notes" name="notes" rows="2" placeholder="Anything else?"></textarea>
            </div>
          </div>
        </details>
        
        <div style="margin-top:24px">
          <button type="submit" class="btn btn-cta" style="width:100%" id="submitBtn">
            Analyze & send report →
          </button>
          <p style="text-align:center;margin-top:12px;font-size:11px;color:var(--muted)">
            ✓ Free during beta • 24h delivery • No spam
          </p>
        </div>
      </form>
      
      <div class="success-box" id="successBox">
        <div class="success-icon">✅</div>
        <div class="success-title">Perfect! Analysis started</div>
        <p class="success-msg">We're comparing your piece to our database. You'll receive your pricing report within 24 hours.</p>
        <div class="queue-info">
          <strong>Your position:</strong> <span id="finalPosition">#8</span> in today's queue<br>
          <strong>Estimated delivery:</strong> <span id="deliveryTime">Tomorrow, 2:30 PM</span>
        </div>
        <button class="btn" onclick="closeModal()" style="margin-top:20px">Got it</button>
      </div>
    </div>
  </div>

  <footer style="padding:40px 20px;text-align:center;border-top:1px solid var(--line);color:var(--muted);font-size:14px">
    <div class="wrap">
      © 2025 PricedRight • <a href="#privacy" onclick="openLegal('privacy'); return false;" style="color:var(--muted);text-decoration:underline">Privacy</a> • <a href="#terms" onclick="openLegal('terms'); return false;" style="color:var(--muted);text-decoration:underline">Terms</a> • Contact: <a href="mailto:beadmatchapp@gmail.com" style="color:var(--muted);text-decoration:underline">beadmatchapp@gmail.com</a>

      <div class="footer-legal" style="text-align:left;margin-top:16px">
        <details id="privacy" class="footer-legal-item" style="margin-bottom:12px">
          <summary style="cursor:pointer;color:var(--fg);font-weight:600">Privacy Policy</summary>
          <div style="font-size:13px;color:var(--muted);margin-top:8px">
            <p>We collect the information you provide when submitting the pricing form: your email address, jewelry photo, platform preference, and optional details about materials, time, and notes. We also collect campaign parameters (e.g., utm_source) that may be appended to your submission. This information is used to provide pricing reports, beta access invitations, product updates, and support.</p>
            <p>Form submissions are processed by Formspree and stored securely. We use Plausible Analytics to understand traffic; Plausible is privacy-friendly and does not use cookies or store personally identifiable data.</p>
            <ul>
              <li><strong>Data we collect:</strong> Email, photo, platform preference, optional materials/time/notes, and UTM parameters.</li>
              <li><strong>How we use it:</strong> To analyze your jewelry and send pricing reports; to contact you about PricedRight beta and updates; to improve our service.</li>
              <li><strong>Photo handling:</strong> Your jewelry photos are analyzed by our team (humans + AI) and stored securely. Photos are never shared publicly or used for marketing without explicit permission.</li>
              <li><strong>Sharing:</strong> We do not sell personal data. Third-party processors: Formspree (form handling) and Plausible (analytics).</li>
              <li><strong>Retention & deletion:</strong> We retain data until you unsubscribe or request deletion. Email <a href="mailto:beadmatchapp@gmail.com">beadmatchapp@gmail.com</a> to access or delete your data.</li>
            </ul>
          </div>
        </details>

        <details id="terms" class="footer-legal-item">
          <summary style="cursor:pointer;color:var(--fg);font-weight:600">Terms of Service</summary>
          <div style="font-size:13px;color:var(--muted);margin-top:8px">
            <h3 style="font-size:1rem;margin:8px 0">Beta Program</h3>
            <p>PricedRight is currently in beta. Beta access is free and no payment is required or collected. By submitting your jewelry for analysis, you understand that:</p>
            <ul>
              <li>Pricing reports are estimates based on our analysis and should be used as guidance only</li>
              <li>Actual market performance may vary based on numerous factors</li>
              <li>Reports are delivered within 24 hours during business days</li>
              <li>Beta features and availability may change without notice</li>
            </ul>
            <h3 style="font-size:1rem;margin:8px 0">Future Pricing</h3>
            <p>We may introduce paid plans after the beta period ends. Any pricing changes will be communicated in advance, and you'll have the option to opt-in or discontinue use. No payment information is collected during beta.</p>
            <h3 style="font-size:1rem;margin:8px 0">Intellectual Property</h3>
            <p>You retain all rights to your jewelry designs and photos. By submitting content, you grant us a limited license to analyze your submission and provide pricing recommendations. We will never use your designs for any purpose other than providing you with pricing analysis without your explicit consent.</p>
            <h3 style="font-size:1rem;margin:8px 0">Disclaimer</h3>
            <p>PricedRight provides pricing suggestions based on market analysis and is not responsible for actual sales performance. Our service is not affiliated with or endorsed by Etsy, Instagram, or any other platform mentioned.</p>
            <p style="margin-top:8px"><strong>Contact:</strong> For any questions about these terms or our privacy practices, email <a href="mailto:beadmatchapp@gmail.com">beadmatchapp@gmail.com</a></p>
          </div>
        </details>
      </div>
    </div>
  </footer>

  <script>
    // State
    let selectedFile = null;
    const modal = document.getElementById('uploadModal');
    const form = document.getElementById('pricingForm');
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const successBox = document.getElementById('successBox');
    
    // Simulated queue (stored per day)
    const today = new Date().toDateString();
    const queueKey = `pr_queue_${today}`;
    let queueData = JSON.parse(localStorage.getItem(queueKey) || '{}');
    
    if (!queueData.position) {
      queueData = {
        position: Math.floor(Math.random() * 8) + 5, // 5-12
        total: 30,
        submitted: 0
      };
      localStorage.setItem(queueKey, JSON.stringify(queueData));
    }
    
    // Update UI
    const spotsLeft = Math.max(0, queueData.total - queueData.position);
    document.getElementById('spotsLeft').textContent = spotsLeft;
    // Guard: element may not exist on page
    const queuePositionEl = document.getElementById('queuePosition');
    if (queuePositionEl) {
      queuePositionEl.textContent = `#${queueData.position} in queue`;
    }
    
    // Modal functions
    function openModal() {
      modal.classList.add('open');
      track('modal_opened');
    }
    
    function closeModal() {
      modal.classList.remove('open');
      if (successBox.style.display === 'block') {
        // Reset form after success
        form.reset();
        form.style.display = 'block';
        successBox.style.display = 'none';
        preview.style.display = 'none';
        selectedFile = null;
      }
    }
    
    function scrollToExample() {
      // On mobile, open the modal instead of scrolling to example
      if (window.innerWidth <= 768) {
        openModal();
      } else {
        // On desktop, scroll to the example section
        document.getElementById('example').scrollIntoView({ behavior: 'smooth' });
      }
    }
    
    // File handling
    uploadZone.addEventListener('click', () => fileInput.click());
    
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('active');
    });
    
    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('active');
    });
    
    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('active');
      const files = e.dataTransfer.files;
      if (files.length > 0) handleFile(files[0]);
    });
    
    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) handleFile(e.target.files[0]);
    });
    
    const MAX_FILE_SIZE = 25 * 1024 * 1024; // 25 MB
    const IMAGE_EXT_RE = /\.(png|jpe?g|gif|webp|heic|heif|bmp|tiff?)$/i;
    
    async function handleFile(file) {
      const isImage = (file.type && file.type.startsWith('image/')) || IMAGE_EXT_RE.test(file.name || '');
      if (!isImage) {
        alert('Please upload an image file');
        return;
      }
      
      // Reject HEIC files
      const isHeic = /heic|heif/i.test(file.type) || /\.(heic|heif)$/i.test(file.name || '');
      if (isHeic) {
        alert('Please use JPG or PNG format (iPhone: use Screenshots or Camera app with "Most Compatible" setting)');
        return;
      }
      
      try {
        if (file.size > MAX_FILE_SIZE) {
          alert('File size must be less than 25MB');
          return;
        }
        selectedFile = file;
        const objectUrl = URL.createObjectURL(file);
        document.getElementById('previewImg').src = objectUrl;
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileSize').textContent = formatFileSize(file.size);
        preview.style.display = 'flex';
        uploadZone.classList.add('has-file');
        uploadZone.innerHTML = '<div style="text-align:center;color:var(--success);font-weight:600">✓ Photo uploaded</div>';
      } catch (e) {
        console.error('Error handling file:', e);
        alert('Could not process the image. Please try a JPG/PNG.');
      }
    }
    
    function removeFile() {
      selectedFile = null;
      fileInput.value = '';
      preview.style.display = 'none';
      uploadZone.classList.remove('has-file');
      uploadZone.innerHTML = '<div class="upload-icon">📸</div><div style="font-weight:600;margin-bottom:4px">Upload YOUR jewelry photo</div><div style="font-size:13px;color:var(--muted)">Click or drag • JPG/PNG up to 25MB</div>';
      // Re-attach the file input
      uploadZone.appendChild(fileInput);
    }
    
    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }
    
    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!selectedFile) {
        alert('Please upload a photo of your jewelry');
        return;
      }
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="spinner"></span> Analyzing...';
      
      // Collect form data
      const formData = new FormData();
      formData.append('email', document.getElementById('email').value);
      formData.append('platform', document.getElementById('platform').value);
      formData.append('materials', document.getElementById('materials').value || '');
      formData.append('time', document.getElementById('time').value || '');
      formData.append('notes', document.getElementById('notes').value || '');
      // Attach selected image directly for Formspree (paid plan)
      if (selectedFile) {
        formData.append('photo', selectedFile, selectedFile.name);
      }
      
      // Add UTM parameters
      const urlParams = new URLSearchParams(window.location.search);
      ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term'].forEach(param => {
        if (urlParams.get(param)) {
          formData.append(param, urlParams.get(param));
        }
      });
      
      // Add metadata
      formData.append('queue_position', queueData.position);
      formData.append('user_agent', navigator.userAgent);
      formData.append('timestamp', new Date().toISOString());
      
      // Add subreddit parameter if present (for Reddit ads)
      if (urlParams.get('subreddit')) {
        formData.append('subreddit', urlParams.get('subreddit'));
      }
      
      // Add referrer
      if (document.referrer) {
        formData.append('referrer', document.referrer);
      }
      
      try {
        // Submit to Formspree
        const response = await fetch('https://formspree.io/f/mwpqyneb', {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });
        
        if (response.ok) {
          // Update queue
          queueData.submitted++;
          localStorage.setItem(queueKey, JSON.stringify(queueData));
          
          // Show success
          document.getElementById('finalPosition').textContent = `#${queueData.position}`;
          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          tomorrow.setHours(14, 30, 0);
          document.getElementById('deliveryTime').textContent = tomorrow.toLocaleString('en-US', {
            weekday: 'long',
            hour: 'numeric',
            minute: '2-digit'
          });
          
          form.style.display = 'none';
          successBox.style.display = 'block';
          
          track('form_submitted', {
            platform: document.getElementById('platform').value,
            has_materials: !!document.getElementById('materials').value,
            has_time: !!document.getElementById('time').value
          });
        } else {
          throw new Error('Submission failed');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Sorry, something went wrong. Please try again or email us at help@pricedright.ai');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'Get my pricing report →';
      }
    });
    
    // Analytics helper
    function track(event, props = {}) {
      if (window.plausible) {
        window.plausible(event, { props });
      }
    }
    
    // Close modal and smoothly scroll to legal section
    function openLegal(sectionId) {
      // Close modal if open
      modal.classList.remove('open');
      // Smoothly scroll to the target after a tiny delay
      setTimeout(() => {
        const el = document.getElementById(sectionId);
        if (el) {
          // If it's a <details>, open it before scrolling
          if (el.tagName && el.tagName.toLowerCase() === 'details') {
            el.open = true;
          }
          if (el.scrollIntoView) {
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        } else {
          location.hash = sectionId;
        }
      }, 50);
    }
    
    // Hide example button on mobile
    function updateExampleButton() {
      const btn = document.querySelector('.example-button');
      if (btn) {
        btn.style.display = window.innerWidth <= 768 ? 'none' : 'inline-block';
      }
    }
    window.addEventListener('resize', updateExampleButton);
    updateExampleButton();
  </script>
</body>
</html>
